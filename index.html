<!DOCTYPE html>
<html>
<head>
   <title>Conector Web</title>
   <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
   <script src="https://connectors.tableau.com/libs/tableauwdc-2.3.latest.js"></script>
</head>
<body>
   <script>
// Lógica del conector web
   (function () {
      var myConnector = tableau.makeConnector();

      myConnector.init = function(initCallback) {
         // Inicialización necesaria
         initCallback();
      };

      myConnector.getSchema = function (schemaCallback) {
         // Definir la estructura del esquema aquí
         var cols = [
      // Definir las columnas del esquema aquí
      { id: "columna1", alias: "Nombre_Columna_1", dataType: tableau.dataTypeEnum.string },
      { id: "columna2", alias: "Nombre_Columna_2", dataType: tableau.dataTypeEnum.int },
      // ... agregar más columnas según sea necesario
   ];

   var tableInfo = {
      id: "nombreTabla",
      alias: "Alias_de_la_Tabla",
      columns: cols
   };

   schemaCallback([tableInfo]);
      };

      myConnector.getData = function (table, doneCallback) {
         // Realizar la solicitud de datos y procesar la respuesta aquí
         var apiUrl = "https://multicaja-dev.outsystemsenterprise.com/OPPortalCore/rest/V1/EventRiskListByProgramId?ProgramaId=6&OrganizacionId=4";

         // Realizar la solicitud GET a la API
         $.ajax({
            url: apiUrl,
            type: "GET",
            dataType: "json",
            success: function (data) {
               // Procesar los datos y enviarlos a Tableau
               doneCallback(data);
            },
            error: function (xhr, textStatus, errorThrown) {
               // Manejar errores
               console.error("Error en la solicitud:", textStatus, errorThrown);
               doneCallback([]);
            }
         });
      };

      tableau.registerConnector(myConnector);

      // Iniciar el conector web
      $(document).ready(function () {
         $("#submitButton").click(function () {
            tableau.connectionName = "Nombre del Conector";
            tableau.submit();
         });
      });
   })();
</script>

<!-- Puedes agregar un formulario simple para la entrada de parámetros si es necesario -->
<form>
   <!-- Campos del formulario aquí -->
   <button id="submitButton">Obtener Datos</button>
</form>
   </script>
</body>
</html>
